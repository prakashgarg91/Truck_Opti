{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Analytics Dashboard</h1>
    <div class="row">
        <div class="col-md-4">
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">Total Shipments</div>
                <div class="card-body">
                    <h5 class="card-title" id="total-shipments"></h5>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success mb-3">
                <div class="card-header">Average Utilization</div>
                <div class="card-body">
                    <h5 class="card-title" id="avg-utilization"></h5>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-info mb-3">
                <div class="card-header">Total Cost</div>
                <div class="card-body">
                    <h5 class="card-title" id="total-cost"></h5>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    Shipments Over Time
                </div>
                <div class="card-body">
                    <canvas id="shipmentsChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/analytics')
            .then(response => response.json())
            .then(data => {
                document.getElementById('total-shipments').innerText = data.total_shipments;
                document.getElementById('avg-utilization').innerText = `${parseFloat(data.avg_utilization).toFixed(2)}%`;
                document.getElementById('total-cost').innerText = `â‚¹${parseFloat(data.total_cost).toFixed(2)}`;

                const shipmentsCtx = document.getElementById('shipmentsChart').getContext('2d');
                new Chart(shipmentsCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'], // Example labels
                        datasets: [{
                            label: '# of Shipments',
                            data: [12, 19, 3, 5, 2, 3], // Example data
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            });
    });
</script>
{% endblock %}